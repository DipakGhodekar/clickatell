#!/usr/bin/env ruby

local_libs = [
 File.join(File.dirname(__FILE__), *%w[../lib/clickatell]),
 File.join(File.dirname(__FILE__), *%w[../lib/clickatell/utility]) 
]

if File.exist?(local_libs.first)
  local_libs.each { |lib| require lib }
else
  require 'rubygems'
  require 'clickatell'
  require 'clickatell/utility'
end

options = Clickatell::Utility::Options.parse(ARGV)
connection = Clickatell::Connection.new(options.api_key, options.username, options.password)

if options.show_balance
  puts "Retrieving account balance..."
  puts "You have #{connection.account_balance} credits remaining."
  exit 0
else
  puts "Sending '#{options.message}' to #{options.recipient}."
  connection.send_message(options.recipient, options.message)
  puts "Done."
  exit 0
end